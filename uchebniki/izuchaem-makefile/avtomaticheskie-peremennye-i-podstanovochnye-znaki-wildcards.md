# Автоматические переменные и подстановочные знаки (wildcards)

## Wildcard \*

И `*`, и `%` называются **подстановочными знаками** в Make, но они означают совершенно разные вещи. `*` ищет в вашей файловой системе совпадающие имена файлов. Я предлагаю вам всегда оборачивать его в функцию **wildcard**, потому что в противном случае вы можете попасть в распространенную ловушку, описанную ниже.

```makefile
# Распечатать информацию о каждом файле .c
print: $(wildcard *.c)
	ls -la  $?
```

`*` может использоваться в цели, пререквизитах или в функции wildcard.

<mark style="color:red;">**Опасно**</mark>: `*` нельзя использовать напрямую в определениях переменных.

<mark style="color:red;">**Опасно**</mark>: когда `*` не соответствует ни одному файлу, он остается как есть (если только не запустить функцию **wildcard**)

```makefile
thing_wrong := *.o # Не делай этого! '*' не будет расширен
thing_right := $(wildcard *.o)

all: one two three four

# Не получится, потому что $(thing_wrong) - это строка "*.o"
one: $(thing_wrong)

# Остается как *.o if there are no files that match this pattern :(
two: *.o 

# Работает так, как вы ожидаете! В этом случае он ничего не делает.
three: $(thing_right)

# То же, что третье правило
four: $(wildcard *.o)
```

## Wildcard %

`%` действительно полезен, но несколько сбивает с толку из-за разнообразия ситуаций, в которых его можно использовать.

* При использовании в режиме сопоставления **"matching"** он соответствует одному или нескольким символам в строке. Это совпадение называется **stem**.
* При использовании в режиме замены **"replacing"** он берет совпадающую основу stem и заменяет ее в строке.
* **%** чаще всего используется в определениях правил и в некоторых специфических функциях.

См. в этих разделах примеры его использования:

* [Статические правила шаблона](neobychnye-pravila.md#staticheskie-pravila-shablona)
* [Правила шаблона](neobychnye-pravila.md#pravila-shablona)
* [Замена строки](funkcii.md#zamena-stroki)
* [Директива vpath](drugie-osobennosti.md#direktiva-vpath)

## Автоматические переменные

Есть много [автоматических переменных](https://www.gnu.org/software/make/manual/html\_node/Automatic-Variables.html), но часто появляются только некоторые из них:

```makefile
hey: one two
	# Выводит "hey", так как это имя цели
	echo $@

	# Выводит все пререквизиты новее, чем цель
	echo $?

	# Выводит все пререквизиты
	echo $^

	touch hey

one:
	touch one

two:
	touch two

clean:
	rm -f hey one two
```
